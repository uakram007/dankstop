/**
 * Module to show Recently Viewed Products
 *
 * Copyright (c) 2014 Caroline Schnapp (11heavens.com)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
Shopify.Products=function(){var e=!1,n={howManyToShow:3,howManyToStoreInMemory:10,wrapperId:"recently-viewed-products",templateId:"recently-viewed-product-template",onComplete:null},t=[],o=null,r=null,i=0,a={configuration:{expires:90,path:"/",domain:window.location.hostname},name:"shopify_recently_viewed",write:function(e){jQuery.cookie(this.name,e.join(" "),this.configuration)},read:function(){var e=[],n=jQuery.cookie(this.name);return null!==n&&null!=n&&(e=n.split(" ")),e},destroy:function(){jQuery.cookie(this.name,null,this.configuration)},remove:function(e){var n=this.read(),t=jQuery.inArray(e,n);-1!==t&&(n.splice(t,1),this.write(n))}},u=function(){t.length>1&&i<n.howManyToShow?jQuery.ajax({dataType:"json",url:"/products/"+t[0]+".js",cache:!1,success:function(e){e.tags.includes("hidden")||(r.tmpl(e).appendTo(o),t.shift(),i++,u())},error:function(){a.remove(t[0]),t.shift(),u()}}):function(){if(o.show(),n.onComplete)try{n.onComplete()}catch(e){}}()};return{resizeImage:function(e,n){if(null==n)return e;if("master"==n)return e.replace(/http(s)?:/,"");var t=e.match(/\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?/i);if(null!=t&&null!=t){var o=e.split(t[0]),r=t[0];return(o[0]+"_"+n+r).replace(/http(s)?:/,"")}return null},showRecentlyViewed:function(i){if(!e){e=!0;i=i||{};jQuery.extend(n,i),t=a.read(),r=jQuery("#"+n.templateId),o=jQuery("#"+n.wrapperId),n.howManyToShow=Math.min(t.length,n.howManyToShow),n.howManyToShow&&r.length&&o.length&&u()}},getConfig:function(){return n},clearList:function(){a.destroy()},recordRecentlyViewed:function(e){e=e||{};jQuery.extend(n,e);var t=a.read();if(-1!==window.location.pathname.indexOf("/products/")){var o=window.location.pathname.match(/\/products\/([a-z0-9\-]+)/)[1],r=jQuery.inArray(o,t);-1===r?(t.unshift(o),t=t.splice(0,n.howManyToStoreInMemory)):(t.splice(r,1),t.unshift(o)),a.write(t)}}}}();